@mixin card-dimensions($span, $width: $card-width, $height: $card-height, $margin: $card-margin)
  $width: ($width * $span) + ($margin * ($span - 1))
  $ratio: (1 / $width) * $height

  padding-top: percentage($ratio)

  &.card--fixed
    width: $width + 0px

.card
  @extend %rounded-corners
  position: relative
  margin-bottom: $card-margin
  background: #FFF

.card--single
  +card-dimensions(1)

.card--double
  +card-dimensions(2)

// -----------------------------------------------------------------------------
// Basic card layout and styles
// -----------------------------------------------------------------------------

.card__mask,
.card__meta,
.card__figure,
.card__content
  position: absolute
  top: 0
  left: 0
  right: 0
  bottom: 0

.card__mask
  @extend %rounded-corners
  overflow: hidden

.card__figure__img
  height: 100%

.card__content
  padding: $card-content-padding
  border-top: 2px solid
  color: $body-copy

.card__content__title
  +font-size(20)
  margin-bottom: 10px

.card__content__desc
  +font-size(15)
  line-height: 1.3
  color: $feature-copy

.card__meta
  +font-size(13)
  top: auto

  // A cheeky extra 1px to cover any seams or
  // artefacts on iDevices when zoomed out
  height: $card-meta-height + 1px
  padding: 0 15px
  color: $feature-copy

.card__meta__content
  position: relative

.card__meta__icon,
.card__meta__avatar
  display: inline-block
  margin-right: .25em
  vertical-align: middle
  border-radius: 50%

.card__meta__avatar
  +size(20px)

.card__meta__icon
  +size(14px)
  +icon-color(white)

  // Fake padding around the icon
  border: 3px solid
  background-size: 15px

.card__meta__author
  font-weight: bold

// -----------------------------------------------------------------------------
// Height variations
// -----------------------------------------------------------------------------

.card--tall

  &.card--has-img

    .card__content
      top: auto

    .card__content__desc
      @extend %visually-hide

    // Standard card
    &.card--standard

      .card__figure__img
        // Avoid fragments appearing
        // behind border radius clip
        // margin-bottom: 5px

      .card__meta,
      .card__content
        background: #FFF

      .card__content
        height: $card-content-height
        transition: height .2s ease-out

      &:hover
        .card__content
          height: $card-content-height + 25px

      &.card--has-meta
        .card__content
          height: $card-content-height - $card-meta-height
          bottom: $card-meta-height

        &:hover
          .card__content
            height: $card-content-height - $card-meta-height + 25px

    // Cover image card
    &.card--cover

      .card__meta,
      .card__content
        color: #FFF

      .card__content
        border-top: 0
        transition: margin-bottom .2s ease-out

      &:hover
        .card__content
          margin-bottom: 25px

      .card__content__title
        +font-size(24)

      &.card--double

        .card__figure__img
          width: 100%
          height: auto

        .card__content__title
          +font-size(32)

  &.card--no-img

    .card__content
      padding-top: 15px

.card--short
  // Short cards are always a single width
  +card-dimensions($span: 1, $height: 195px)

  &.card--has-img

    // Short cards with an image should always act
    // as a cover image whether told to or not.
    .card__figure__img
      width: 100%
      height: auto

    .card__meta,
    .card__content
      color: #FFF

    .card__content
      top: auto
      border-top: 0

    .card__content__title
      +font-size(24)

    .card__content__desc
      @extend %visually-hide

// -----------------------------------------------------------------------------
// Image attribution
// -----------------------------------------------------------------------------

.card__attribution
  position: absolute
  right: 0
  left: 0
  top: 0
  overflow: hidden

.card__attribution__tooltip
  +font-size(12)
  position: relative
  left: -100%
  width: 100%
  transition: left .25s ease-out

  &:hover
    left: 0

.card__attribution__content
  margin: 5px
  padding: 5px
  background: #FFF
  border-radius: 3px

.card__attribution__toggle
  position: absolute
  top: 5px
  left: 100%
  margin-left: -5px
  padding: 1px 1px 1px 5px
  background-color: #FFF
  border-radius: 0 9px 9px 0

  &:before
    display: block
    width: 16px
    height: 16px

.card__attribution__licenses

  .license
    display: inline-block
    overflow: hidden
    height: 28px
    width: 32px
    margin: -6px -6px 0
    text-indent: -999em

.card__attribution__caption

// -----------------------------------------------------------------------------
// Paraphernalia
// -----------------------------------------------------------------------------

.card

  // Price tag adjustments
  .tag--price__values
    padding-top: 10px
